{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, Input, ViewChild } from '@angular/core';\nimport { icon, map, marker, tileLayer } from 'leaflet';\nimport { CommonModule } from '@angular/common';\nlet MapComponent = class MapComponent {\n  constructor(locationService) {\n    this.locationService = locationService;\n    this.readonly = false;\n    this.MARKER_ZOOM_LEVEL = 16;\n    this.MARKER_ICON = icon({\n      iconUrl: 'https://res.cloudinary.com/foodmine/image/upload/v1638842791/map/marker_kbua9q.png',\n      iconSize: [42, 42],\n      iconAnchor: [21, 42]\n    });\n    this.DEFAULT_LATLNG = [13.75, 21.62];\n  }\n  ngOnChanges() {\n    if (!this.order) return;\n    this.initializeMap();\n    if (this.readonly && this.addressLatLng) {\n      this.showLocationOnReadonlyMode();\n    }\n  }\n  showLocationOnReadonlyMode() {\n    var _a, _b;\n    const m = this.map;\n    this.setMarker(this.addressLatLng);\n    m.setView(this.addressLatLng, this.MARKER_ZOOM_LEVEL);\n    m.dragging.disable();\n    m.touchZoom.disable();\n    m.doubleClickZoom.disable();\n    m.scrollWheelZoom.disable();\n    m.boxZoom.disable();\n    m.keyboard.disable();\n    m.off('click');\n    (_a = m.tap) === null || _a === void 0 ? void 0 : _a.disable();\n    (_b = this.currentMarker.dragging) === null || _b === void 0 ? void 0 : _b.disable();\n  }\n  initializeMap() {\n    if (this.map) return;\n    this.map = map(this.mapRef.nativeElement, {\n      attributionControl: false\n    }).setView(this.DEFAULT_LATLNG, 1);\n    tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(this.map);\n    this.map.on('click', e => {\n      this.setMarker(e.latlng);\n    });\n  }\n  findMyLocation() {\n    this.locationService.getCurrentLocation().subscribe({\n      next: latlng => {\n        this.map.setView(latlng, this.MARKER_ZOOM_LEVEL);\n        this.setMarker(latlng);\n      }\n    });\n  }\n  setMarker(latlng) {\n    this.addressLatLng = latlng;\n    if (this.currentMarker) {\n      this.currentMarker.setLatLng(latlng);\n      return;\n    }\n    this.currentMarker = marker(latlng, {\n      draggable: true,\n      icon: this.MARKER_ICON\n    }).addTo(this.map);\n    this.currentMarker.on('dragend', () => {\n      this.addressLatLng = this.currentMarker.getLatLng();\n    });\n  }\n  set addressLatLng(latlng) {\n    if (!latlng.lat.toFixed) return;\n    latlng.lat = parseFloat(latlng.lat.toFixed(8));\n    latlng.lng = parseFloat(latlng.lng.toFixed(8));\n    this.order.addressLatLng = latlng;\n    console.log(this.order.addressLatLng);\n  }\n  get addressLatLng() {\n    return this.order.addressLatLng;\n  }\n};\n__decorate([Input()], MapComponent.prototype, \"order\", void 0);\n__decorate([Input()], MapComponent.prototype, \"readonly\", void 0);\n__decorate([ViewChild('map', {\n  static: true\n})], MapComponent.prototype, \"mapRef\", void 0);\nMapComponent = __decorate([Component({\n  selector: 'map',\n  templateUrl: './map.component.html',\n  styleUrls: ['./map.component.css'],\n  imports: [CommonModule]\n})], MapComponent);\nexport { MapComponent };","map":{"version":3,"names":["Component","Input","ViewChild","icon","map","marker","tileLayer","CommonModule","MapComponent","constructor","locationService","readonly","MARKER_ZOOM_LEVEL","MARKER_ICON","iconUrl","iconSize","iconAnchor","DEFAULT_LATLNG","ngOnChanges","order","initializeMap","addressLatLng","showLocationOnReadonlyMode","m","setMarker","setView","dragging","disable","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard","off","_a","tap","_b","currentMarker","mapRef","nativeElement","attributionControl","addTo","on","e","latlng","findMyLocation","getCurrentLocation","subscribe","next","setLatLng","draggable","getLatLng","lat","toFixed","parseFloat","lng","console","log","__decorate","static","selector","templateUrl","styleUrls","imports"],"sources":["C:\\EXO ANGULAR\\foodmine-course-master\\frontend\\src\\app\\components\\partials\\map\\map.component.ts"],"sourcesContent":["import { Component, ElementRef, Input, OnChanges, ViewChild } from '@angular/core';\nimport { icon, LatLng, LatLngExpression, LatLngTuple, LeafletMouseEvent, map, Map, marker, Marker, tileLayer } from 'leaflet';\nimport { LocationService } from 'src/app/services/location.service';\nimport { Order } from 'src/app/shared/models/Order';\nimport { CommonModule } from '@angular/common';\n\n@Component({\n  selector: 'map',\n  templateUrl: './map.component.html',\n  styleUrls: ['./map.component.css'],\n  imports:[\n    CommonModule,\n  ],\n})\nexport class MapComponent implements OnChanges {\n  \n  @Input() order: any;\n  @Input()\n  readonly = false;\n  private readonly MARKER_ZOOM_LEVEL = 16;\n  private readonly MARKER_ICON = icon({\n    iconUrl:\n      'https://res.cloudinary.com/foodmine/image/upload/v1638842791/map/marker_kbua9q.png',\n    iconSize: [42, 42],\n    iconAnchor: [21, 42],\n  });\n  private readonly DEFAULT_LATLNG: LatLngTuple = [13.75, 21.62];\n\n  @ViewChild('map', {static:true})\n  mapRef!: ElementRef;\n  map!:Map;\n  currentMarker!:Marker;\n\n  constructor(private locationService: LocationService) { }\n\n  ngOnChanges(): void {\n    if(!this.order) return;\n    this.initializeMap();\n\n    if(this.readonly && this.addressLatLng){\n      this.showLocationOnReadonlyMode();\n    }\n  }\n  showLocationOnReadonlyMode() {\n    const m = this.map;\n    this.setMarker(this.addressLatLng);\n    m.setView(this.addressLatLng, this.MARKER_ZOOM_LEVEL);\n\n    m.dragging.disable();\n    m.touchZoom.disable();\n    m.doubleClickZoom.disable();\n    m.scrollWheelZoom.disable();\n    m.boxZoom.disable();\n    m.keyboard.disable();\n    m.off('click');\n    m.tap?.disable();\n    this.currentMarker.dragging?.disable();\n  }\n\n  initializeMap(){\n    if(this.map) return;\n\n    this.map = map(this.mapRef.nativeElement, {\n      attributionControl: false\n    }).setView(this.DEFAULT_LATLNG, 1);\n\n    tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(this.map);\n\n    this.map.on('click', (e:LeafletMouseEvent) => {\n      this.setMarker(e.latlng);\n    })\n  }\n\n  findMyLocation(){\n    this.locationService.getCurrentLocation().subscribe({\n      next: (latlng) => {\n        this.map.setView(latlng, this.MARKER_ZOOM_LEVEL)\n        this.setMarker(latlng)\n      }\n    })\n  }\n\n  setMarker(latlng:LatLngExpression){\n    this.addressLatLng = latlng as LatLng;\n    if(this.currentMarker)\n    {\n      this.currentMarker.setLatLng(latlng);\n      return;\n    }\n\n    this.currentMarker = marker(latlng, {\n      draggable: true,\n      icon: this.MARKER_ICON\n    }).addTo(this.map);\n\n\n    this.currentMarker.on('dragend', () => {\n      this.addressLatLng = this.currentMarker.getLatLng();\n    })\n  }\n\n  set addressLatLng(latlng: LatLng){\n    if(!latlng.lat.toFixed) return;\n\n    latlng.lat = parseFloat(latlng.lat.toFixed(8));\n    latlng.lng = parseFloat(latlng.lng.toFixed(8));\n    this.order.addressLatLng = latlng;\n    console.log(this.order.addressLatLng);\n  }\n\n  get addressLatLng(){\n    return this.order.addressLatLng!;\n  }\n}\n"],"mappings":";AAAA,SAASA,SAAS,EAAcC,KAAK,EAAaC,SAAS,QAAQ,eAAe;AAClF,SAASC,IAAI,EAA4DC,GAAG,EAAOC,MAAM,EAAUC,SAAS,QAAQ,SAAS;AAG7H,SAASC,YAAY,QAAQ,iBAAiB;AAU9C,IAAaC,YAAY,GAAzB,MAAaA,YAAY;EAmBvBC,YAAoBC,eAAgC;IAAhC,KAAAA,eAAe,GAAfA,eAAe;IAfnC,KAAAC,QAAQ,GAAG,KAAK;IACC,KAAAC,iBAAiB,GAAG,EAAE;IACtB,KAAAC,WAAW,GAAGV,IAAI,CAAC;MAClCW,OAAO,EACL,oFAAoF;MACtFC,QAAQ,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC;MAClBC,UAAU,EAAE,CAAC,EAAE,EAAE,EAAE;KACpB,CAAC;IACe,KAAAC,cAAc,GAAgB,CAAC,KAAK,EAAE,KAAK,CAAC;EAOL;EAExDC,WAAWA,CAAA;IACT,IAAG,CAAC,IAAI,CAACC,KAAK,EAAE;IAChB,IAAI,CAACC,aAAa,EAAE;IAEpB,IAAG,IAAI,CAACT,QAAQ,IAAI,IAAI,CAACU,aAAa,EAAC;MACrC,IAAI,CAACC,0BAA0B,EAAE;;EAErC;EACAA,0BAA0BA,CAAA;;IACxB,MAAMC,CAAC,GAAG,IAAI,CAACnB,GAAG;IAClB,IAAI,CAACoB,SAAS,CAAC,IAAI,CAACH,aAAa,CAAC;IAClCE,CAAC,CAACE,OAAO,CAAC,IAAI,CAACJ,aAAa,EAAE,IAAI,CAACT,iBAAiB,CAAC;IAErDW,CAAC,CAACG,QAAQ,CAACC,OAAO,EAAE;IACpBJ,CAAC,CAACK,SAAS,CAACD,OAAO,EAAE;IACrBJ,CAAC,CAACM,eAAe,CAACF,OAAO,EAAE;IAC3BJ,CAAC,CAACO,eAAe,CAACH,OAAO,EAAE;IAC3BJ,CAAC,CAACQ,OAAO,CAACJ,OAAO,EAAE;IACnBJ,CAAC,CAACS,QAAQ,CAACL,OAAO,EAAE;IACpBJ,CAAC,CAACU,GAAG,CAAC,OAAO,CAAC;IACd,CAAAC,EAAA,GAAAX,CAAC,CAACY,GAAG,cAAAD,EAAA,uBAAAA,EAAA,CAAEP,OAAO,EAAE;IAChB,CAAAS,EAAA,OAAI,CAACC,aAAa,CAACX,QAAQ,cAAAU,EAAA,uBAAAA,EAAA,CAAET,OAAO,EAAE;EACxC;EAEAP,aAAaA,CAAA;IACX,IAAG,IAAI,CAAChB,GAAG,EAAE;IAEb,IAAI,CAACA,GAAG,GAAGA,GAAG,CAAC,IAAI,CAACkC,MAAM,CAACC,aAAa,EAAE;MACxCC,kBAAkB,EAAE;KACrB,CAAC,CAACf,OAAO,CAAC,IAAI,CAACR,cAAc,EAAE,CAAC,CAAC;IAElCX,SAAS,CAAC,0CAA0C,CAAC,CAACmC,KAAK,CAAC,IAAI,CAACrC,GAAG,CAAC;IAErE,IAAI,CAACA,GAAG,CAACsC,EAAE,CAAC,OAAO,EAAGC,CAAmB,IAAI;MAC3C,IAAI,CAACnB,SAAS,CAACmB,CAAC,CAACC,MAAM,CAAC;IAC1B,CAAC,CAAC;EACJ;EAEAC,cAAcA,CAAA;IACZ,IAAI,CAACnC,eAAe,CAACoC,kBAAkB,EAAE,CAACC,SAAS,CAAC;MAClDC,IAAI,EAAGJ,MAAM,IAAI;QACf,IAAI,CAACxC,GAAG,CAACqB,OAAO,CAACmB,MAAM,EAAE,IAAI,CAAChC,iBAAiB,CAAC;QAChD,IAAI,CAACY,SAAS,CAACoB,MAAM,CAAC;MACxB;KACD,CAAC;EACJ;EAEApB,SAASA,CAACoB,MAAuB;IAC/B,IAAI,CAACvB,aAAa,GAAGuB,MAAgB;IACrC,IAAG,IAAI,CAACP,aAAa,EACrB;MACE,IAAI,CAACA,aAAa,CAACY,SAAS,CAACL,MAAM,CAAC;MACpC;;IAGF,IAAI,CAACP,aAAa,GAAGhC,MAAM,CAACuC,MAAM,EAAE;MAClCM,SAAS,EAAE,IAAI;MACf/C,IAAI,EAAE,IAAI,CAACU;KACZ,CAAC,CAAC4B,KAAK,CAAC,IAAI,CAACrC,GAAG,CAAC;IAGlB,IAAI,CAACiC,aAAa,CAACK,EAAE,CAAC,SAAS,EAAE,MAAK;MACpC,IAAI,CAACrB,aAAa,GAAG,IAAI,CAACgB,aAAa,CAACc,SAAS,EAAE;IACrD,CAAC,CAAC;EACJ;EAEA,IAAI9B,aAAaA,CAACuB,MAAc;IAC9B,IAAG,CAACA,MAAM,CAACQ,GAAG,CAACC,OAAO,EAAE;IAExBT,MAAM,CAACQ,GAAG,GAAGE,UAAU,CAACV,MAAM,CAACQ,GAAG,CAACC,OAAO,CAAC,CAAC,CAAC,CAAC;IAC9CT,MAAM,CAACW,GAAG,GAAGD,UAAU,CAACV,MAAM,CAACW,GAAG,CAACF,OAAO,CAAC,CAAC,CAAC,CAAC;IAC9C,IAAI,CAAClC,KAAK,CAACE,aAAa,GAAGuB,MAAM;IACjCY,OAAO,CAACC,GAAG,CAAC,IAAI,CAACtC,KAAK,CAACE,aAAa,CAAC;EACvC;EAEA,IAAIA,aAAaA,CAAA;IACf,OAAO,IAAI,CAACF,KAAK,CAACE,aAAc;EAClC;CACD;AAjGUqC,UAAA,EAARzD,KAAK,EAAE,C,0CAAY;AAEpByD,UAAA,EADCzD,KAAK,EAAE,C,6CACS;AAWjByD,UAAA,EADCxD,SAAS,CAAC,KAAK,EAAE;EAACyD,MAAM,EAAC;AAAI,CAAC,CAAC,C,2CACZ;AAfTnD,YAAY,GAAAkD,UAAA,EARxB1D,SAAS,CAAC;EACT4D,QAAQ,EAAE,KAAK;EACfC,WAAW,EAAE,sBAAsB;EACnCC,SAAS,EAAE,CAAC,qBAAqB,CAAC;EAClCC,OAAO,EAAC,CACNxD,YAAY;CAEf,CAAC,C,EACWC,YAAY,CAmGxB;SAnGYA,YAAY"},"metadata":{},"sourceType":"module","externalDependencies":[]}